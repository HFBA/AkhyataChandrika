# Not Found Dhatu IDs Workflow

## Overview

Some verbs in the JSON data have `dhatu_id` marked as **"Not Found"**, meaning they need manual assignment of the correct dhatu_id.

This workflow provides scripts to:
1. Collect all verbs with "Not Found" dhatu_ids
2. Allow manual editing to assign correct dhatu_ids
3. Backport the corrections to original YAML files

## Problem Statement

- **607 verbs** have dhatu_id = "Not Found"
- These verbs need proper dhatu_ids assigned manually
- After assignment, changes must be synced back to original YAML files

## Scripts

### 1. collectNotFoundDhatuIds.py

**Purpose**: Scans the JSON file and collects all verbs where dhatu_id is "Not Found" into separate YAML files.

**Usage**:
```bash
python3 Scripts/AI_Generated/scripts/collectNotFoundDhatuIds.py \
    Scripts/output/AkhyataChandrika_Autogenerated.json \
    Scripts/AI_Generated/output
```

**What it does**:
- Reads the auto-generated JSON file
- Finds all verb entries where `dhatu_id` equals "Not Found"
- Separates them into two categories based on presence of gati
- Creates ONE YAML file with all such cases (without gati only)
- Each entry includes complete metadata for accurate backporting

**Note**: This script automatically skips the नानार्थवर्गः folder.

**Outputs**:
- `Scripts/AI_Generated/output/not_found_dhatu_ids_without_gati.yaml` - 576 unique verbs

**Note:** Verbs with gati that have "Not Found" dhatu_id are currently 0 entries and not generated.

### 2. backportNotFoundDhatuIds.py

**Purpose**: Syncs manually edited dhatu_id assignments back to the original YAML files.

**Usage**:

Option 1 - Process all files in directory (recommended):
```bash
python3 Scripts/AI_Generated/scripts/backportNotFoundDhatuIds.py \
    Scripts/AI_Generated/output \
    Data
```

Option 2 - Process a single file:
```bash
python3 Scripts/AI_Generated/scripts/backportNotFoundDhatuIds.py \
    Scripts/AI_Generated/output/not_found_dhatu_ids_without_gati.yaml \
    Data
```

**What it does**:
- Reads the manually edited YAML file(s)
- For each entry where "Not Found" has been replaced with an actual dhatu_id:
  - Locates the corresponding original YAML file
  - Finds the specific verb within the shloka and artha
  - Updates from `null` to `[dhatu_id]` or `[gati, dhatu_id]`
  - Preserves the gati field if present
- Skips entries still marked as "Not Found" (not edited yet)
- Reports detailed statistics of changes made

**Note**: This script also automatically skips the नानार्थवर्गः folder.

## Workflow

### Step 1: Generate the JSON (if not already done)
```bash
# Use existing scripts to generate JSON from YAML files
```

### Step 2: Collect "Not Found" Cases
```bash
python3 Scripts/AI_Generated/scripts/collectNotFoundDhatuIds.py \
    Scripts/output/AkhyataChandrika_Autogenerated.json \
    Scripts/AI_Generated/output
```

This creates:
- `not_found_dhatu_ids_without_gati.yaml` (576 verbs)

### Step 3: Manually Edit the YAML File

Open `not_found_dhatu_ids_without_gati.yaml` and replace "Not Found" with actual dhatu_ids.

**Before** (needs correction):
```yaml
"सिद्ध्यति":
  "dhatu_id": "Not Found"     # ← Needs manual assignment
  "gati": ""
  ...
```

**After** (corrected):
```yaml
"सिद्ध्यति":
  "dhatu_id": "04.0087"        # ← Assigned correct dhatu_id
  "gati": ""
  ...
```

**Important**:
- Only change the `dhatu_id` field
- Do NOT modify `gati`, `form`, or any other fields
- You can edit a few entries at a time and backport incrementally

### Step 4: Backport Changes to Original YAML Files

**Recommended**: Process all at once:
```bash
python3 Scripts/AI_Generated/scripts/backportNotFoundDhatuIds.py \
    Scripts/AI_Generated/output \
    Data
```

The script will:
- Process only entries where "Not Found" was replaced
- Skip entries still marked as "Not Found"
- Update original YAML files
- Report statistics

### Step 5: Regenerate the JSON
```bash
# Use existing scripts to regenerate JSON from the updated YAML files
```

## Example

### Initial State
The verb "सिद्ध्यति" has dhatu_id = "Not Found"

### After Collection
`not_found_dhatu_ids_without_gati.yaml` contains:
```yaml
"सिद्ध्यति":
  "form": "सिद्ध्यति"
  "dhatu_id": "Not Found"
  "gati": ""
  "kanda": "प्रथमकाण्डः"
  "varga": "भावविकारवर्गः"
  "artha": "सिद्धौ"
  "shloka_num": "2"
  "shloka_text": "निर्वर्तते सम्भवति सिद्धौ सिध्यति राध्यति । निष्पद्यते च राध्नोति साध्नोति फलतीति च ॥"
```

### Manual Correction
You determine the correct dhatu_id is "04.0087":
```yaml
"सिद्ध्यति":
  "dhatu_id": "04.0087"  # ← Changed from "Not Found"
  ...
```

### After Backport
The original YAML file `Data/1_प्रथमकाण्डः/1_भावविकारवर्गः.yaml` is updated:
```yaml
"निर्वर्तते सम्भवति सिद्धौ सिध्यति राध्यति । निष्पद्यते च राध्नोति साध्नोति फलतीति च ॥":
  "सिद्धौ":
    "सिद्ध्यति":
    - "04.0087"  # ← Updated from null
```

## Statistics

Current status:
- **Total "Not Found" cases**: 607 occurrences
- **Unique verbs**: 595
- **With gati**: 0
- **Without gati**: 595

## Incremental Editing

You don't have to edit all 595 verbs at once! You can:

1. Edit 10-20 entries
2. Run backport for those entries
3. Verify the changes
4. Continue with the next batch

The backport script automatically skips entries still marked as "Not Found".

## Tips

- **Start small**: Edit and backport 10-20 verbs at a time
- **Group by varga**: Focus on one varga at a time for better context
- **Keep metadata**: Don't modify any fields except `dhatu_id`
- **Backup**: Consider using git to track changes
- **Reference**: Use धातुपाठ or other Sanskrit dictionaries to find correct dhatu_ids

## Notes

- The scripts preserve YAML structure and formatting
- The नानार्थवर्गः folder is automatically excluded
- Backport creates a detailed report of all changes
- Can process files incrementally
- Skips unedited entries automatically

## Related

This workflow is similar to the [Multiple Dhatu IDs workflow](README_MultipleDhatuIds.md), but handles cases where dhatu_id is missing entirely rather than having multiple values.
